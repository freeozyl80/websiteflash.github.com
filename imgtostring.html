<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>image to string demo</title>
  <style type="text/css">
    body{

    }
    #output{
      font-family:Monospace;
      font-size:5px;
      -webkit-transform:scale(0.5);
      -moz-transform:scale(0.5);
      transform:scale(0.5);
      text-align: left;
    }
  </style>
</head>
<body>
<input type="file" id="fileupload" accept="image/png, image/jpeg">
<p id="output"></p>
<canvas id="myCanvas">no support ie!</canvas>

<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script type="text/javascript">
  var $img = new Image();
  var $cv = $('#myCanvas');
  var $fileupload = $('#fileupload');
  var $out = $('#output');

  $fileupload.on('change', function(){
    var reader = new FileReader();
    reader.readAsDataURL($fileupload[0].files[0]);
    reader.onload = function () {
      $img.src = reader.result;
    }
  });

  $img.onload = function(){
    ImgToString();
  };

  function ImgToString(){
    var cv = $cv[0];
    var ctx = cv.getContext('2d');
    var iw = $img.width;
    var ih = $img.height;

    cv.width = iw;
    cv.height = ih;

    ctx.drawImage($img, 0, 0);
    var iData = ctx.getImageData(0, 0, iw, ih);
    var iDataArr = iData.data;
    var iDataWidth = iData.width;
    var iDataHeight = iData.height;
    var str = '', w=0, h=0;
    for (h = 0; h < iDataHeight; h += 6) {
        for (w = 0; w < iDataWidth; w += 4) {
            var index = (w + iDataWidth * h) * 4;
            var r = iDataArr[index + 0];
            var g = iDataArr[index + 1];
            var b = iDataArr[index + 2];
            var gray = getGray(r, g, b);
            str += pixToString(gray);
        }
        str += '<br>';
    }
    $out.html(str);
  }

  function pixToString(g) {
    var str = 'MNHQ$OC?7>!:-;.';
    return str[parseInt(g*14/255, 10)];
}

function getGray(r, g, b) {
    return 0.299 * r + 0.578 * g + 0.114 * b;
}

</script>
</body>
</html>
